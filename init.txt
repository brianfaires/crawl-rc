## Config at start of file
lua_file = crawl-rc/lua/core/config.lua

####### Main options #######
easy_confirm = all
show_more = false
small_more = true
mouse_input = false
default_manual_training = true
autofight_caught = true
rest_wait_both = true
rest_wait_ancestor = true

autofight_stop = 40
hp_warning = 20
item_stack_summary_minimum = 8
fail_severity_to_confirm = 4

sort_menus = true:equipped,art,ego,basename,identified,qualname,>qty
drop_filter += useless_item, forbidden
fire_order = silver javelin, javelin, silver boomerang, boomerang, curare-tipped dart, poisoned dart, dart, stone


####### Explore options #######
explore_delay = -1
travel_delay = -1
rest_delay = -1
view_delay = 100
show_travel_trail = true

explore_stop = altars,branches,portals,runed_doors,greedy_pickup_smart
explore_stop_pickup_ignore += scroll, potion, misc, wand, stone, dart, boomerang, javelin


### Mostly normal RC options ###
include = crawl-rc/rc/autoinscribe.rc
include = crawl-rc/rc/autopickup.rc
include = crawl-rc/rc/display.rc
include = crawl-rc/rc/fm-messages.rc
include = crawl-rc/rc/macros.rc
include = crawl-rc/rc/runrest.rc
include = crawl-rc/rc/slot-defaults.rc

### buehler.rc core files ###
lua_file = crawl-rc/lua/core/constants.lua
lua_file = crawl-rc/lua/core/emojis.lua
lua_file = crawl-rc/lua/core/persistent-data.lua
lua_file = crawl-rc/lua/core/util.lua
lua_file = crawl-rc/lua/core/brc.lua

### Lua feature files ###
lua_file = crawl-rc/lua/features/after-shaft.lua
lua_file = crawl-rc/lua/features/announce-damage.lua
lua_file = crawl-rc/lua/features/color-inscribe.lua
lua_file = crawl-rc/lua/features/drop-inferior.lua
lua_file = crawl-rc/lua/features/dynamic-options.lua
lua_file = crawl-rc/lua/features/exclude-dropped.lua
lua_file = crawl-rc/lua/features/fully-recover.lua
lua_file = crawl-rc/lua/features/fm-disable.lua
lua_file = crawl-rc/lua/features/fm-monsters.lua
lua_file = crawl-rc/lua/features/inscribe-stats.lua
lua_file = crawl-rc/lua/features/misc-alerts.lua
lua_file = crawl-rc/lua/features/remind-id.lua
lua_file = crawl-rc/lua/features/runrest-features.lua
lua_file = crawl-rc/lua/features/safe-consumables.lua
lua_file = crawl-rc/lua/features/safe-stairs.lua
lua_file = crawl-rc/lua/features/startup.lua
lua_file = crawl-rc/lua/features/weapon-slots.lua

### Pickup and alert - Core files ###
lua_file = crawl-rc/lua/pickup-alert/pa-main.lua
lua_file = crawl-rc/lua/pickup-alert/pa-data.lua
lua_file = crawl-rc/lua/pickup-alert/pa-util.lua

### Pickup and alert - Feature files ###
lua_file = crawl-rc/lua/pickup-alert/pa-armour.lua
lua_file = crawl-rc/lua/pickup-alert/pa-misc.lua
lua_file = crawl-rc/lua/pickup-alert/pa-weapons.lua


############## Lua Hook Functions ##############
{
-- Hook functions that delegate to BRC
function ready()
    if BRC then BRC:ready() end
end

function c_message(text, channel)
    if BRC then BRC:c_message(text, channel) end
end

function c_answer_prompt(prompt)
    if BRC then BRC:c_answer_prompt(prompt) end
end

function c_assign_invletter(it)
  if BRC then BRC:c_assign_invletter(it) end
end

function init_buehler(reset_persistent_data)
    -- Initialize core modules first (these are required)
    init_config()
    init_emojis()
    init_util()
    init_persistent_data(reset_persistent_data)
    
    -- Load and register all features with BRC
    local loaded_count = BRC:load_all_features()
    
    if loaded_count == 0 then
        crawl.mpr(with_color(COLORS.lightred, "No features loaded. BRC system is inactive."))
        return false
    end
    
    -- Success!
    local success_emoji = CONFIG.emojis and EMOJI.SUCCESS or ""
    local success_text = string.format(" Successfully initialized BRC system v%s! ", BRC.VERSION)
    crawl.mpr("\n" .. success_emoji .. with_color(COLORS.lightgreen, success_text) .. success_emoji)
    
    return true
end

-- This is the only line of top-level code, aside from declaring variables (without values)
-- Done to give confidence in simple re-inits
init_buehler(you.turns() == 0)
}
